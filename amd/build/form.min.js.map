{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * blocks/ungraded_activities.php\n *\n * @module     block_ungraded_activities\n * @copyright  2021 Gordon Bateson (gordon.bateson@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      Moodle 2.9\n */\n\ndefine([\"core/str\"], function(STR) {\n\n    /** @alias module:block_ungraded_activities/view */\n    var JS = {};\n\n    // cache the plugin name and string cache\n    JS.plugin = \"block_ungraded_activities\";\n    JS.str = {};\n\n    /*\n     * initialize this AMD module\n     */\n    JS.init = function() {\n\n        STR.get_strings([\n            {\"key\": \"deselectall\",    \"component\": \"moodle\"},\n            {\"key\": \"selectall\",      \"component\": \"moodle\"},\n            {\"key\": \"apply\",          \"component\": JS.plugin},\n            {\"key\": \"exportsettings\", \"component\": JS.plugin},\n            {\"key\": \"importsettings\", \"component\": JS.plugin}\n        ]).done(function(s) {\n            var i = 0;\n            JS.str.deselectall    = s[i++];\n            JS.str.selectall      = s[i++];\n            JS.str.apply          = s[i++];\n            JS.str.exportsettings = s[i++];\n            JS.str.importsettings = s[i++];\n\n            var fieldsets = \"#id_title, #id_activities, #id_users, #id_date, #id_applyselectedvalues\";\n            JS.add_itemselect_checkboxes(fieldsets);\n\n            JS.setup_dateformats();\n        });\n    };\n\n    JS.add_event_listener = function(obj, evt, fn, useCapture) {\n        if (obj.addEventListener) {\n            obj.addEventListener(evt, fn, (useCapture || false));\n        } else if (obj.attachEvent) {\n            obj.attachEvent(\"on\" + evt, fn);\n        }\n    };\n\n    JS.add_itemselect_checkboxes = function(fieldsets){\n\n        // sm: for tablets - screens equal to or greater than 768px wide\n        // md: for small laptops - screens equal to or greater than 992px wide\n        var viewportwidth = Math.max(document.documentElement.clientWidth, (window.innerWidth || 0));\n        var smallviewport = (viewportwidth < 992);\n\n        var mycourses = document.querySelector(\"select[name^=config_mycourses]\");\n\n        document.querySelectorAll(fieldsets).forEach(function(fieldset){\n            fieldset.querySelectorAll(\".row.fitem .col-md-9\").forEach(function(elm, i){\n                if (mycourses) {\n                    JS.add_itemselect_checkbox(elm, i, smallviewport);\n                }\n                // Add zebra strip to odd numbered form items.\n                if (elm.parentNode.matches(\":nth-child(odd)\")) {\n                    elm.parentNode.classList.add(\"bg-light\");\n                }\n            });\n        });\n    };\n\n    JS.add_itemselect_checkbox = function(elm, i, smallviewport){\n        var div = document.createElement(\"DIV\");\n\n        var node = null;\n\n        // get name of parent element e.g. \"fitem_id_description\"\n        // and remove everything up to final underscore \"_\".\n        var name = elm.parentNode.id;\n        name = name.replace(new RegExp(\"^.+_\"), \"\");\n\n        if (name == \"description\") {\n            elm.classList.remove(\"col-md-9\");\n            elm.classList.add(\"col-7\");\n            //elm.classList.add(\"bg-light\");\n            //elm.classList.add(\"border-top\");\n            //elm.classList.add(\"border-bottom\");\n\n            //div.classList.add(\"d-none\");\n            //div.classList.add(\"d-md-block\");\n            div.classList.add(\"col-5\");\n            div.classList.add(\"col-md-2\");\n            div.classList.add(\"px-0\");\n            div.classList.add(\"text-right\");\n\n            node = elm.querySelector(\".exportsettings\");\n            if (node) {\n                div.appendChild(node);\n            }\n\n            node = elm.querySelector(\".importsettings\");\n            if (node) {\n                div.appendChild(node);\n            }\n\n            var input = document.createElement(\"INPUT\");\n            input.setAttribute(\"type\", \"checkbox\");\n            input.setAttribute(\"name\", \"select_all\");\n            input.setAttribute(\"id\", \"id_select_all\");\n            input.classList.add(\"ml-2\");\n            JS.add_event_listener(input, \"change\", JS.onchange_selectall);\n\n            var label = document.createElement(\"LABEL\");\n            label.setAttribute(\"for\", \"id_select_all\");\n            label.classList.add(\"d-inline\");\n            label.innerText = JS.str.selectall;\n\n            node = document.createElement(\"DIV\");\n            node.classList.add(\"bg-secondary\");\n            if (i == 0 || smallviewport) {\n                node.classList.add(\"border-top\");\n            }\n            node.classList.add(\"border-bottom\");\n            node.classList.add(\"border-dark\");\n            node.classList.add(\"w-100\"); // width: 100%\n            node.classList.add(\"py-1\");\n            node.classList.add(\"text-right\");\n            if (smallviewport) {\n                node.style.paddingRight = \"24px\";\n            } else {\n                node.style.paddingRight = \"35px\";\n            }\n            node.classList.add(\"itemselect\");\n\n            node.appendChild(label);\n            node.appendChild(input);\n\n            div.appendChild(node);\n        } else {\n            elm.classList.remove(\"col-md-9\");\n            elm.classList.add(\"col-10\");\n            elm.classList.add(\"col-md-8\");\n\n            //div.classList.add(\"d-none\");\n            //div.classList.add(\"d-md-block\");\n            div.classList.add(\"col-2\");\n            div.classList.add(\"col-md-1\");\n            div.classList.add(\"bg-secondary\");\n            if (i == 0 || smallviewport) {\n                div.classList.add(\"border-top\");\n            }\n            div.classList.add(\"border-bottom\");\n            div.classList.add(\"border-dark\");\n            div.classList.add(\"px-0\");\n            div.classList.add(\"py-1\");\n            div.classList.add(\"text-center\");\n            div.classList.add(\"itemselect\");\n\n            node = document.createElement(\"INPUT\");\n            if (name == \"mycourses\") {\n                // Create button to \"Apply\" settings.\n                node.setAttribute(\"type\", \"submit\");\n                node.setAttribute(\"value\", JS.str.apply);\n                node.classList.add(\"btn\");\n                node.classList.add(\"btn-primary\");\n                node.classList.add(\"my-1\");\n                node.classList.add(\"px-2\");\n            } else {\n                // Create checkbox for this setting.\n                node.setAttribute(\"type\", \"checkbox\");\n                node.setAttribute(\"name\", \"select_\" + name);\n                node.setAttribute(\"id\", \"id_select_\" + name);\n                node.classList.add(\"mt-2\");\n            }\n\n            div.appendChild(node);\n        }\n\n        elm.parentNode.insertBefore(div, elm.nextSibling);\n    };\n\n    JS.onchange_selectall = function(){\n        var checked = this.checked;\n        var label = this.parentNode.querySelector(\"label\");\n        if (label) {\n            label.innerText = (checked ? JS.str.deselectall : JS.str.selectall);\n        }\n        var s = \".itemselect input[type=checkbox]:not([name=\" + this.name + \"])\";\n        document.querySelectorAll(s).forEach(function(checkbox){\n            checkbox.checked = checked;\n        });\n    };\n\n    JS.setup_dateformats = function(){\n\n        // Cache URL of \"switch_plus\" icon\n        var src = M.util.image_url(\"t/switch_plus\");\n        // M.cfg.wwwroot + \"/theme/image.php/\" + M.cfg.theme + \"/core/\" + M.cfg.themerev + \"/t/switch_plus\";\n\n        var s = \"#fgroup_id_elements_moodledatefmt .fitem\";\n        document.querySelectorAll(s).forEach(function(fitem, i){\n            if (i == 0) {\n                fitem.classList.add(\"justify-content-start\");\n            }\n            fitem.classList.add(\"d-block\"); // override \"flex\"\n\n            var txt = fitem.querySelector(\"small\");\n            if (txt) {\n                var img = document.createElement(\"IMG\");\n                img.src = src;\n                img.classList.add(\"ml-2\");\n                JS.add_event_listener(img, \"click\", JS.onclick_dateformat);\n\n                fitem.insertBefore(img, txt);\n                txt.classList.add(\"d-none\");\n                txt.classList.add(\"ml-4\");\n            }\n        });\n    };\n\n    JS.onclick_dateformat = function(){\n        var fitem = this.closest(\".fitem\");\n        if (fitem) {\n            var txt = fitem.querySelector(\"small\");\n            if (txt) {\n                if (txt.classList.contains(\"d-none\")) {\n                    txt.classList.replace(\"d-none\", \"d-block\");\n                    this.src = this.src.replace('plus','minus');\n                } else {\n                    txt.classList.replace(\"d-block\", \"d-none\");\n                    this.src = this.src.replace('minus','plus');\n                }\n            }\n        }\n    };\n\n    return JS;\n});"],"names":["define","STR","JS","get_strings","plugin","done","s","i","str","deselectall","selectall","apply","exportsettings","importsettings","add_itemselect_checkboxes","setup_dateformats","obj","evt","fn","useCapture","addEventListener","attachEvent","fieldsets","smallviewport","Math","max","document","documentElement","clientWidth","window","innerWidth","mycourses","querySelector","querySelectorAll","forEach","fieldset","elm","add_itemselect_checkbox","parentNode","matches","classList","add","div","createElement","node","name","id","replace","RegExp","remove","appendChild","input","setAttribute","add_event_listener","onchange_selectall","label","innerText","style","paddingRight","insertBefore","nextSibling","checked","this","checkbox","src","M","util","image_url","fitem","txt","img","onclick_dateformat","closest","contains"],"mappings":"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"}